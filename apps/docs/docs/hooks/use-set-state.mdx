---
title: useSetState
description: 模拟类组件的 setState 方法，支持对象合并更新
---

# useSetState

模拟类组件的 `setState` 方法，支持对象合并更新。

## 使用场景

- 管理复杂对象状态
- 从类组件迁移到函数组件
- 需要部分更新对象状态

## 安装

```bash
npm install @lynkit/hooks
# 或
pnpm add @lynkit/hooks
```

## 代码演示

### 基础用法

管理对象状态，支持部分更新。

```tsx preview
import { useSetState } from '@lynkit/hooks';

export default () => {
  const [state, setState] = useSetState({
    name: 'LynKit',
    count: 0,
  });
  
  return (
    <div>
      <p style={{ marginBottom: '12px', color: '#666' }}>
        名称: <strong>{state.name}</strong> | 计数: <strong>{state.count}</strong>
      </p>
      <div style={{ display: 'flex', gap: '8px' }}>
        <button 
          onClick={() => setState({ count: state.count + 1 })}
          style={{
            padding: '8px 16px',
            background: '#646cff',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          计数 +1
        </button>
        <button 
          onClick={() => setState({ name: 'Updated!' })}
          style={{
            padding: '8px 16px',
            background: '#42b883',
            color: 'white',
            border: 'none',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          更新名称
        </button>
        <button 
          onClick={() => setState({ name: 'LynKit', count: 0 })}
          style={{
            padding: '8px 16px',
            background: '#f5f5f5',
            color: '#333',
            border: '1px solid #ddd',
            borderRadius: '6px',
            cursor: 'pointer'
          }}
        >
          重置
        </button>
      </div>
    </div>
  );
};
```

### 表单状态管理

适用于表单场景的状态管理。

```tsx preview
import { useSetState } from '@lynkit/hooks';

export default () => {
  const [form, setForm] = useSetState({
    username: '',
    email: '',
    age: 18,
  });
  
  return (
    <div style={{ maxWidth: '300px' }}>
      <div style={{ marginBottom: '12px' }}>
        <label style={{ display: 'block', marginBottom: '4px', fontSize: '14px', color: '#666' }}>
          用户名
        </label>
        <input
          value={form.username}
          onChange={(e) => setForm({ username: e.target.value })}
          placeholder="请输入用户名"
          style={{
            width: '100%',
            padding: '8px 12px',
            border: '1px solid #ddd',
            borderRadius: '6px',
            fontSize: '14px'
          }}
        />
      </div>
      <div style={{ marginBottom: '12px' }}>
        <label style={{ display: 'block', marginBottom: '4px', fontSize: '14px', color: '#666' }}>
          邮箱
        </label>
        <input
          value={form.email}
          onChange={(e) => setForm({ email: e.target.value })}
          placeholder="请输入邮箱"
          style={{
            width: '100%',
            padding: '8px 12px',
            border: '1px solid #ddd',
            borderRadius: '6px',
            fontSize: '14px'
          }}
        />
      </div>
      <div style={{ marginBottom: '16px' }}>
        <label style={{ display: 'block', marginBottom: '4px', fontSize: '14px', color: '#666' }}>
          年龄: {form.age}
        </label>
        <input
          type="range"
          min="1"
          max="100"
          value={form.age}
          onChange={(e) => setForm({ age: Number(e.target.value) })}
          style={{ width: '100%' }}
        />
      </div>
      <pre style={{ 
        background: '#f5f5f5', 
        padding: '12px', 
        borderRadius: '6px',
        fontSize: '12px',
        overflow: 'auto'
      }}>
        {JSON.stringify(form, null, 2)}
      </pre>
    </div>
  );
};
```

### 函数式更新

支持传入函数进行更新。

```tsx preview
import { useSetState } from '@lynkit/hooks';

export default () => {
  const [state, setState] = useSetState({
    count: 0,
    history: [] as number[],
  });
  
  const increment = () => {
    setState(prev => ({
      count: prev.count + 1,
      history: [...prev.history, prev.count + 1],
    }));
  };
  
  return (
    <div>
      <p style={{ marginBottom: '12px', color: '#666' }}>
        当前值: <strong>{state.count}</strong>
      </p>
      <p style={{ marginBottom: '12px', color: '#666', fontSize: '14px' }}>
        历史记录: {state.history.join(' → ') || '(空)'}
      </p>
      <button 
        onClick={increment}
        style={{
          padding: '8px 16px',
          background: '#646cff',
          color: 'white',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer'
        }}
      >
        增加并记录
      </button>
    </div>
  );
};
```

## API

### 类型签名

```typescript
function useSetState<T extends object>(
  initialState: T | (() => T)
): [T, (patch: Partial<T> | ((prevState: T) => Partial<T>)) => void]
```

### 参数

| 参数 | 说明 | 类型 | 必填 |
|------|------|------|------|
| initialState | 初始状态 | `T \| (() => T)` | ✓ |

### 返回值

| 返回值 | 说明 | 类型 |
|--------|------|------|
| state | 当前状态 | `T` |
| setState | 更新状态函数 | `(patch: Partial<T> \| ((prev: T) => Partial<T>)) => void` |

## 与 useState 的区别

| 特性 | useSetState | useState |
|------|-------------|----------|
| 更新方式 | 合并更新 | 替换更新 |
| 适用类型 | 对象状态 | 任意类型 |
| 部分更新 | ✅ 支持 | ❌ 需手动展开 |

```typescript
// useSetState - 自动合并
setState({ name: 'new' }); // { name: 'new', count: 0 }

// useState - 需要手动合并
setState(prev => ({ ...prev, name: 'new' }));
```
